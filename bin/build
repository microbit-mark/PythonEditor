#!/bin/bash
set -e
set -u
set -o pipefail

pushd "$(dirname $0)" > /dev/null
SCRIPTPATH="$(pwd)"
popd > /dev/null

SRC="${SCRIPTPATH}/../"
DEST="${SRC}dist/"

rm -rf "${DEST}"
mkdir "${DEST}"

for submodule in blockly microbit_blocks; do
  if [ ! -f "${SRC}/$submodule/.git" ]; then
    echo "The $submodule submodule is not initialised!"
    echo "Initialising all submodules..."
    git submodule update --init --recursive
    echo "...done"
  fi
done

echo "Copying files to the ${DEST} folder..."

# Manually select HTMl files needed, excluding things like tests.html
for file in editor.html help.html; do
  cp "${SRC}/$file" "${DEST}"
done

# Assume all JavaScript files in the root directory are needed
for file in *.js; do
  cp "${SRC}/$file" "${DEST}"
done

for dir in ace blockly lang microbit_blocks static; do
  cp -r "${SRC}/$dir" "${DEST}"
done

echo "...done"
